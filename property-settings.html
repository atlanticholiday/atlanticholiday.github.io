<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Settings</title>
    <link rel="stylesheet" href="styles/main.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .header-icon {
            background: #fef2f2;
            color: #dc2626;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .header-text h1 {
            color: #dc2626;
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
        }
        
        .header-text p {
            color: #6b7280;
            margin: 0.25rem 0 0 0;
            font-size: 1rem;
        }
        
        .back-btn {
            background: white;
            color: #374151;
            border: 1px solid #d1d5db;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            transition: all 0.2s;
        }
        
        .back-btn:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }
        
        .property-info {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }
        
        .section-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #111827;
            margin: 0;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .info-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
        }
        
        .info-label {
            color: #dc2626;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .info-value {
            color: #111827;
            font-size: 1.125rem;
            font-weight: 600;
        }
        
        .form-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .form-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #374151;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .form-label i {
            color: #dc2626;
            width: 16px;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 0.2s;
            background: white;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        
        .form-input::placeholder {
            color: #9ca3af;
        }
        
        .actions {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        .btn-secondary {
            background: white;
            color: #374151;
            border: 1px solid #d1d5db;
        }
        
        .btn-secondary:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }
        
        .btn-primary {
            background: #dc2626;
            color: white;
        }
        
        .btn-primary:hover {
            background: #b91c1c;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="header-content">
        <div class="header-left">
          <div class="header-icon">
            <i class="fas fa-cog"></i>
          </div>
          <div class="header-text">
            <h1>Property Settings</h1>
            <p>Manage links, credentials, and advanced property details</p>
          </div>
        </div>
        <button id="back-to-dashboard" class="back-btn">
          <i class="fas fa-arrow-left"></i>
          <span>Back to Dashboard</span>
        </button>
      </div>
    </div>

    <!-- Property Info -->
    <div class="property-info">
      <div class="section-header">
        <div class="section-icon" style="background: #fef2f2; color: #dc2626;">
          <i class="fas fa-home"></i>
        </div>
        <h2 class="section-title">Property Information</h2>
      </div>
      <div class="info-grid">
        <div class="info-card">
          <div class="info-label">Property Name</div>
          <div id="property-name-display" class="info-value">Loading...</div>
        </div>
        <div class="info-card">
          <div class="info-label">Location</div>
          <div id="property-location-display" class="info-value">Loading...</div>
        </div>
        <div class="info-card">
          <div class="info-label">Property Type</div>
          <div id="property-type-display" class="info-value">Loading...</div>
        </div>
      </div>
    </div>

    <form id="property-settings-form">
      <input type="hidden" id="settings-property-id" value="">
      
      <!-- Maps & Location -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #fef2f2; color: #dc2626;">
            <i class="fas fa-map-marker-alt"></i>
          </div>
          <h2 class="section-title">Maps & Location</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-map"></i>
              <span>Location on Google Maps</span>
            </label>
            <input type="url" id="settings-google-maps-link" class="form-input" placeholder="Insert Maps link">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-trash"></i>
              <span>Garbage Location</span>
            </label>
            <input type="url" id="settings-garbage-location-link" class="form-input" placeholder="Insert Maps link">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-layer-group"></i>
              <span>Garbage Floor</span>
            </label>
            <input type="text" id="settings-garbage-floor" class="form-input" placeholder="e.g. Ground">
          </div>
        </div>
      </div>

      <!-- Media & Content -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #f3e8ff; color: #9333ea;">
            <i class="fas fa-video"></i>
          </div>
          <h2 class="section-title">Media & Content</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-video"></i>
              <span>Check-in Videos</span>
            </label>
            <input type="number" id="settings-checkin-videos" class="form-input" min="0" placeholder="How many?">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-file-alt"></i>
              <span>Descriptions on Booking</span>
            </label>
            <select id="settings-booking-description-status" class="form-input">
              <option value="">Select an option</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
              <option value="missing">Missing</option>
              <option value="needs-updating">Needs updating</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Google Drive -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #f0fdf4; color: #16a34a;">
            <i class="fab fa-google-drive"></i>
          </div>
          <h2 class="section-title">Google Drive</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fab fa-google-drive"></i>
              <span>Google Drive Enabled</span>
            </label>
            <select id="settings-google-drive-enabled" class="form-input">
              <option value="no">No</option>
              <option value="yes">Yes</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-folder"></i>
              <span>Google Drive Folder Link</span>
            </label>
            <input type="url" id="settings-google-drive-link" class="form-input" placeholder="Insert link">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-file-upload"></i>
              <span>Scanned Documents Folder</span>
            </label>
            <input type="url" id="settings-scanned-docs-link" class="form-input" placeholder="Google Drive folder link">
          </div>
        </div>
      </div>

      <!-- Recommendations -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #fefce8; color: #ca8a04;">
            <i class="fas fa-star"></i>
          </div>
          <h2 class="section-title">Recommendations</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-link"></i>
              <span>Recommendations Link</span>
            </label>
            <input type="url" id="settings-recommendations-link" class="form-input" placeholder="Insert link">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-edit"></i>
              <span>Recommendations Links to Edit</span>
            </label>
            <input type="url" id="settings-recommendations-edit-link" class="form-input" placeholder="Insert link">
          </div>
        </div>
      </div>

      <!-- Legal & Compliance -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #fef2f2; color: #dc2626;">
            <i class="fas fa-gavel"></i>
          </div>
          <h2 class="section-title">Legal & Compliance</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-file-contract"></i>
              <span>Contracts</span>
            </label>
            <select id="settings-contracts-status" class="form-input">
              <option value="">Select an option</option>
              <option value="signed">Signed</option>
              <option value="missing-signature">Missing Signature</option>
              <option value="old">Old</option>
              <option value="not-necessary">Not necessary</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-book"></i>
              <span>Complaint Books</span>
            </label>
            <select id="settings-complaint-books-status" class="form-input">
              <option value="">Select an option</option>
              <option value="in-office">In the office</option>
              <option value="missing">Missing</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-chart-bar"></i>
              <span>Statistics</span>
            </label>
            <select id="settings-statistics-status" class="form-input">
              <option value="">Select an option</option>
              <option value="on-platform">On the Platform</option>
              <option value="missing">Missing</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-passport"></i>
              <span>SEF (Foreigners & Borders Service)</span>
            </label>
            <select id="settings-sef-status" class="form-input">
              <option value="">Select an option</option>
              <option value="on-platform">On the platform</option>
              <option value="missing">Missing</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Online Services -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #eef2ff; color: #6366f1;">
            <i class="fas fa-globe"></i>
          </div>
          <h2 class="section-title">Online Services</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-book-open"></i>
              <span>Online Complaint Books</span>
            </label>
            <select id="settings-online-complaint-books-enabled" class="form-input">
              <option value="no">No</option>
              <option value="yes">Yes</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-envelope"></i>
              <span>Online Complaint Book Account Email</span>
            </label>
            <input type="email" id="settings-online-complaint-books-email" class="form-input" placeholder="Enter email">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-lock"></i>
              <span>Online Complaint Book Password</span>
            </label>
            <input type="password" id="settings-online-complaint-books-password" class="form-input" placeholder="Enter password">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fab fa-airbnb"></i>
              <span>Custom Airbnb Links</span>
            </label>
            <select id="settings-airbnb-links-status" class="form-input">
              <option value="">Select an option</option>
              <option value="yes">Yes</option>
              <option value="missing">Missing</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions">
        <div class="action-buttons">
          <button type="button" id="settings-cancel-btn" class="btn btn-secondary">
            <i class="fas fa-times"></i>
            <span>Cancel</span>
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i>
            <span>Save Settings</span>
          </button>
        </div>
      </div>
    </form>
  </div>

  <script>
    document.getElementById('back-to-dashboard').addEventListener('click', () => window.location.href = 'index.html');
    document.getElementById('settings-cancel-btn').addEventListener('click', () => window.location.href = 'index.html');
    
    // Load property data when page loads
    async function loadPropertyData() {
      const urlParams = new URLSearchParams(window.location.search);
      const propertyId = urlParams.get('id');
      
      if (!propertyId) {
        console.error('No property ID provided');
        return;
      }
      
      // Store property ID for form submission
      document.getElementById('settings-property-id').value = propertyId;
      
      try {
        // Get property data from the properties manager
        // Since we're on a separate page, we need to get the data from the main app
        // For now, let's try to get it from the parent window or use a different approach
        
        // Try to get from sessionStorage (if passed from main app)
        const propertyData = sessionStorage.getItem('currentProperty');
        let property = null;
        
        if (propertyData) {
          property = JSON.parse(propertyData);
        } else {
          // Fallback: try to get from localStorage with a different key
          const properties = JSON.parse(localStorage.getItem('firestore_properties') || '[]');
          property = properties.find(p => p.id === propertyId);
        }
        
        if (property) {
          // Populate property info display
          document.getElementById('property-name-display').textContent = property.name || 'Not specified';
          document.getElementById('property-location-display').textContent = property.location || 'Not specified';
          document.getElementById('property-type-display').textContent = property.typology || property.type || 'Not specified';
          
          // Populate form fields with existing data
          document.getElementById('settings-google-maps-link').value = property.googleMapsLink || '';
          document.getElementById('settings-garbage-location-link').value = property.garbageLocationLink || '';
          document.getElementById('settings-garbage-floor').value = property.garbageFloor || '';
          document.getElementById('settings-checkin-videos').value = property.checkinVideos || '';
          document.getElementById('settings-booking-description-status').value = property.bookingDescriptionStatus || '';
          document.getElementById('settings-google-drive-enabled').value = property.googleDriveEnabled || 'no';
          document.getElementById('settings-google-drive-link').value = property.googleDriveLink || '';
          document.getElementById('settings-scanned-docs-link').value = property.scannedDocsLink || '';
          document.getElementById('settings-recommendations-link').value = property.recommendationsLink || '';
          document.getElementById('settings-recommendations-edit-link').value = property.recommendationsEditLink || '';
          document.getElementById('settings-contracts-status').value = property.contractsStatus || '';
          document.getElementById('settings-complaint-books-status').value = property.complaintBooksStatus || '';
          document.getElementById('settings-statistics-status').value = property.statisticsStatus || '';
          document.getElementById('settings-sef-status').value = property.sefStatus || '';
          document.getElementById('settings-online-complaint-books-enabled').value = property.onlineComplaintBooksEnabled || 'no';
          document.getElementById('settings-online-complaint-books-email').value = property.onlineComplaintBooksEmail || '';
          document.getElementById('settings-online-complaint-books-password').value = property.onlineComplaintBooksPassword || '';
          document.getElementById('settings-airbnb-links-status').value = property.airbnbLinksStatus || '';
        } else {
          console.error('Property not found');
          document.getElementById('property-name-display').textContent = 'Property not found';
          document.getElementById('property-location-display').textContent = 'Property not found';
          document.getElementById('property-type-display').textContent = 'Property not found';
        }
      } catch (error) {
        console.error('Error loading property data:', error);
      }
    }
    
    // Handle form submission
    document.getElementById('property-settings-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const propertyId = document.getElementById('settings-property-id').value;
      if (!propertyId) {
        alert('No property ID found');
        return;
      }
      
      // Collect form data
      const formData = {
        googleMapsLink: document.getElementById('settings-google-maps-link').value,
        garbageLocationLink: document.getElementById('settings-garbage-location-link').value,
        garbageFloor: document.getElementById('settings-garbage-floor').value,
        checkinVideos: parseInt(document.getElementById('settings-checkin-videos').value) || 0,
        bookingDescriptionStatus: document.getElementById('settings-booking-description-status').value,
        googleDriveEnabled: document.getElementById('settings-google-drive-enabled').value,
        googleDriveLink: document.getElementById('settings-google-drive-link').value,
        scannedDocsLink: document.getElementById('settings-scanned-docs-link').value,
        recommendationsLink: document.getElementById('settings-recommendations-link').value,
        recommendationsEditLink: document.getElementById('settings-recommendations-edit-link').value,
        contractsStatus: document.getElementById('settings-contracts-status').value,
        complaintBooksStatus: document.getElementById('settings-complaint-books-status').value,
        statisticsStatus: document.getElementById('settings-statistics-status').value,
        sefStatus: document.getElementById('settings-sef-status').value,
        onlineComplaintBooksEnabled: document.getElementById('settings-online-complaint-books-enabled').value,
        onlineComplaintBooksEmail: document.getElementById('settings-online-complaint-books-email').value,
        onlineComplaintBooksPassword: document.getElementById('settings-online-complaint-books-password').value,
        airbnbLinksStatus: document.getElementById('settings-airbnb-links-status').value
      };
      
      try {
        // Store the updated data in sessionStorage for the main app to pick up
        const currentProperty = sessionStorage.getItem('currentProperty');
        if (currentProperty) {
          const property = JSON.parse(currentProperty);
          const updatedProperty = { ...property, ...formData };
          sessionStorage.setItem('currentProperty', JSON.stringify(updatedProperty));
          sessionStorage.setItem('propertySettingsUpdated', 'true');
        }
        
        alert('Settings saved successfully! Please return to the main page to see the changes.');
        window.location.href = 'index.html';
      } catch (error) {
        console.error('Error saving settings:', error);
        alert('Error saving settings. Please try again.');
      }
    });
    
    // Load data when page loads
    document.addEventListener('DOMContentLoaded', loadPropertyData);
  </script>
</body>
</html> 