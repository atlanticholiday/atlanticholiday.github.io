<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Settings</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/property-settings-update.css">
    <style>
        /* Ensure all form sections are expanded */
        .form-section .form-grid {
            display: grid !important;
        }

        /* Hide any arrows in the section header */
        .section-header::after {
            content: none !important;
        }

        /* Collapsible section styles */
        .section-header {
            cursor: pointer;
            position: relative;
            padding-right: 30px; /* Space for single arrow */
        }

        .section-header .arrow {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.3s ease;
        }

        .section-header .arrow.expanded {
            transform: translateY(-50%) rotate(180deg);
        }

        .form-section .form-grid {
            display: none; /* Start hidden */
        }

        .form-section.expanded .form-grid {
            display: grid;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="header-content">
        <div class="header-left">
          <div class="header-icon">
            <i class="fas fa-cog"></i>
          </div>
          <div class="header-text">
            <h1>Property Settings</h1>
            <p>Manage links, credentials, and advanced property details</p>
          </div>
        </div>
        <div class="header-actions">
          <button id="back-to-dashboard" class="btn">
            <i class="fas fa-arrow-left"></i>
            <span>Back</span>
          </button>
          <button id="save-settings" class="btn btn-primary">
            <i class="fas fa-save"></i>
            <span>Save Changes</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Property Info -->
    <div id="section-basic-info" class="property-info">
      <div class="section-header">
        <div class="section-header-title">
            <div class="section-icon" style="background: #fef2f2; color: #dc2626;">
              <i class="fas fa-home"></i>
            </div>
            <h2 class="section-title">Property Information</h2>
        </div>
      </div>
      <div class="info-grid">
        <div class="info-card">
          <div class="info-label">Property Name</div>
          <div id="property-name-display" class="info-value">Loading...</div>
        </div>
        <div class="info-card">
          <div class="info-label">Location</div>
          <div id="property-location-display" class="info-value">Loading...</div>
        </div>
        <div class="info-card">
          <div class="info-label">Property Type</div>
          <div id="property-type-display" class="info-value">Loading...</div>
        </div>
      </div>
    </div>

    <form id="property-settings-form">
      <input type="hidden" id="settings-property-id" value="">

      <!-- Maps & Location -->
      <div id="section-maps-location" class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #fef2f2; color: #dc2626;">
            <i class="fas fa-map-marker-alt"></i>
          </div>
          <h2 class="section-title">Maps & Location</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-map"></i>
              <span>Location on Google Maps</span>
            </label>
            <input type="url" id="settings-google-maps-link" class="form-input" placeholder="Insert Maps link">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-trash"></i>
              <span>Garbage Location</span>
            </label>
            <input type="url" id="settings-garbage-location-link" class="form-input" placeholder="Insert Maps link">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-layer-group"></i>
              <span>Garbage Floor</span>
            </label>
            <input type="text" id="settings-garbage-floor" class="form-input" placeholder="e.g. Ground">
          </div>
        </div>
      </div>

      <!-- Media & Content -->
      <div id="section-media-content" class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #f3e8ff; color: #9333ea;">
            <i class="fas fa-video"></i>
          </div>
          <h2 class="section-title">Media & Content</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-video"></i>
              <span>Check-in Videos</span>
            </label>
            <input type="number" id="settings-checkin-videos" class="form-input" min="0" placeholder="How many?">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-file-alt"></i>
              <span>Descriptions on Booking</span>
            </label>
            <select id="settings-booking-description-status" class="form-input">
              <option value="">Select an option</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
              <option value="missing">Missing</option>
              <option value="needs-updating">Needs updating</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Google Drive -->
      <div id="section-google-drive" class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #f0fdf4; color: #16a34a;">
            <i class="fab fa-google-drive"></i>
          </div>
          <h2 class="section-title">Google Drive</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fab fa-google-drive"></i>
              <span>Google Drive Enabled</span>
            </label>
            <select id="settings-google-drive-enabled" class="form-input">
              <option value="no">No</option>
              <option value="yes">Yes</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-folder"></i>
              <span>Google Drive Folder Link</span>
            </label>
            <input type="url" id="settings-google-drive-link" class="form-input" placeholder="Insert link">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-file-upload"></i>
              <span>Scanned Documents Folder</span>
            </label>
            <input type="url" id="settings-scanned-docs-link" class="form-input" placeholder="Google Drive folder link">
          </div>
        </div>
      </div>

      <!-- Recommendations -->
      <div id="section-recommendations" class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #fefce8; color: #ca8a04;">
            <i class="fas fa-star"></i>
          </div>
          <h2 class="section-title">Recommendations</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-link"></i>
              <span>Recommendations Link</span>
            </label>
            <input type="url" id="settings-recommendations-link" class="form-input" placeholder="Insert link">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-edit"></i>
              <span>Recommendations Links to Edit</span>
            </label>
            <input type="url" id="settings-recommendations-edit-link" class="form-input" placeholder="Insert link">
          </div>
        </div>
      </div>

      <!-- Legal & Compliance -->
      <div id="section-legal-compliance" class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #fef2f2; color: #dc2626;">
            <i class="fas fa-gavel"></i>
          </div>
          <h2 class="section-title">Legal & Compliance</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-file-contract"></i>
              <span>Contracts</span>
            </label>
            <select id="settings-contracts-status" class="form-input">
              <option value="">Select an option</option>
              <option value="signed">Signed</option>
              <option value="missing-signature">Missing Signature</option>
              <option value="old">Old</option>
              <option value="not-necessary">Not necessary</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-book"></i>
              <span>Complaint Books</span>
            </label>
            <select id="settings-complaint-books-status" class="form-input">
              <option value="">Select an option</option>
              <option value="in-office">In the office</option>
              <option value="missing">Missing</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-chart-bar"></i>
              <span>Statistics</span>
            </label>
            <select id="settings-statistics-status" class="form-input">
              <option value="">Select an option</option>
              <option value="on-platform">On the Platform</option>
              <option value="missing">Missing</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-passport"></i>
              <span>SEF (Foreigners & Borders Service)</span>
            </label>
            <select id="settings-sef-status" class="form-input">
              <option value="">Select an option</option>
              <option value="on-platform">On the platform</option>
              <option value="missing">Missing</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Online Services -->
      <div id="section-online-services" class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #eef2ff; color: #6366f1;">
            <i class="fas fa-globe"></i>
          </div>
          <h2 class="section-title">Online Services</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-book-open"></i>
              <span>Online Complaint Books</span>
            </label>
            <select id="settings-online-complaint-books-enabled" class="form-input">
              <option value="no">No</option>
              <option value="yes">Yes</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-envelope"></i>
              <span>Online Complaint Book Account Email</span>
            </label>
            <input type="email" id="settings-online-complaint-books-email" class="form-input" placeholder="Enter email">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-lock"></i>
              <span>Online Complaint Book Password</span>
            </label>
            <input type="password" id="settings-online-complaint-books-password" class="form-input" placeholder="Enter password">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fab fa-airbnb"></i>
              <span>Custom Airbnb Links</span>
            </label>
            <select id="settings-airbnb-links-status" class="form-input">
              <option value="">Select an option</option>
              <option value="yes">Yes</option>
              <option value="missing">Missing</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Connectivity & Utilities -->
      <div id="section-connectivity-utilities" class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #eef2ff; color: #1d4ed8;">
            <i class="fas fa-wifi"></i>
          </div>
          <h2 class="section-title">Connectivity & Utilities</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-signal"></i>
              <span>WiFi Speed</span>
            </label>
            <select id="settings-wifi-speed" class="form-input">
              <option value="">Select Speed</option>
              <option value="basic">&lt; 25 Mbps</option>
              <option value="standard">25-50 Mbps</option>
              <option value="fast">50-100 Mbps</option>
              <option value="very-fast">100+ Mbps</option>
              <option value="fiber">Fiber (500+ Mbps)</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-bolt"></i>
              <span>Energy Source</span>
            </label>
            <select id="settings-energy-source" class="form-input">
              <option value="">Select Source</option>
              <option value="electric">Electric</option>
              <option value="gas">Gas</option>
              <option value="mixed">Mixed</option>
              <option value="solar">Solar</option>
              <option value="heat-pump">Heat Pump</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Access & Parking -->
      <div id="section-access-parking" class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #f0fdf4; color: #059669;">
            <i class="fas fa-parking"></i>
          </div>
          <h2 class="section-title">Access & Parking</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-key"></i>
              <span>Key Box Code</span>
            </label>
            <input type="text" id="settings-key-box-code" class="form-input" placeholder="Enter code">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-car"></i>
              <span>Parking Spot Number</span>
            </label>
            <input type="text" id="settings-parking-spot" class="form-input" placeholder="Enter spot">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-layer-group"></i>
              <span>Parking Floor</span>
            </label>
            <input type="text" id="settings-parking-floor" class="form-input" placeholder="Enter floor">
          </div>
        </div>
      </div>

      <!-- Equipment -->
      <div id="section-equipment" class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #fef2f2; color: #dc2626;">
            <i class="fas fa-toolbox"></i>
          </div>
          <h2 class="section-title">Equipment</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-snowflake"></i>
              <span>Air Conditioning (units)</span>
            </label>
            <input type="number" id="settings-air-conditioning" class="form-input" min="0" placeholder="0">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-fan"></i>
              <span>Fans (units)</span>
            </label>
            <input type="number" id="settings-fans" class="form-input" min="0" placeholder="0">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-fire"></i>
              <span>Heaters (units)</span>
            </label>
            <input type="number" id="settings-heaters" class="form-input" min="0" placeholder="0">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-baby"></i>
              <span>Crib (units)</span>
            </label>
            <input type="number" id="settings-crib" class="form-input" min="0" placeholder="0">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-mattress-pillow"></i>
              <span>Crib Mattress (units)</span>
            </label>
            <input type="number" id="settings-crib-mattress" class="form-input" min="0" placeholder="0">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-chair"></i>
              <span>Baby Chair (units)</span>
            </label>
            <input type="number" id="settings-baby-chair" class="form-input" min="0" placeholder="0">
          </div>
        </div>
      </div>

      <!-- Frames -->
      <div id="section-frames" class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #f3e8ff; color: #7e22ce;">
            <i class="fas fa-border-all"></i>
          </div>
          <h2 class="section-title">Frames</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-wifi"></i>
              <span>WiFi Frame</span>
            </label>
            <select id="settings-wifi-frame" class="form-input">
              <option value="">Select</option>
              <option value="placed">Placed</option>
              <option value="no">No</option>
              <option value="done">Done</option>
              <option value="check">Check</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-star"></i>
              <span>Recommendations Frame</span>
            </label>
            <select id="settings-recommendations-frame" class="form-input">
              <option value="">Select</option>
              <option value="placed">Placed</option>
              <option value="no">No</option>
              <option value="done">Done</option>
              <option value="check">Check</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-chart-line"></i>
              <span>Investment Frame</span>
            </label>
            <select id="settings-investment-frame" class="form-input">
              <option value="">Select</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
              <option value="do-not-place">Do not place</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Services & Extras -->
      <div id="section-services-extras" class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #fefce8; color: #a16207;">
            <i class="fas fa-concierge-bell"></i>
          </div>
          <h2 class="section-title">Services & Extras</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-utensils"></i>
              <span>Breakfast in a box</span>
            </label>
            <select id="settings-breakfast-box" class="form-input">
              <option value="">Select</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Signage -->
      <div id="section-signage" class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #eef2ff; color: #2563eb;">
            <i class="fas fa-sign"></i>
          </div>
          <h2 class="section-title">Signage</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-door-open"></i>
              <span>Private Sign</span>
            </label>
            <select id="settings-private-sign" class="form-input">
              <option value="">Select</option>
              <option value="yes">Yes</option>
              <option value="needs-checking">Needs checking</option>
              <option value="not-necessary">Not necessary</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-smoking-ban"></i>
              <span>No Smoking Sign</span>
            </label>
            <select id="settings-no-smoking-sign" class="form-input">
              <option value="">Select</option>
              <option value="yes">Yes</option>
              <option value="needs-checking">Needs checking</option>
              <option value="not-necessary">Not necessary</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-inbox"></i>
              <span>No Junk Mail Sign</span>
            </label>
            <select id="settings-no-junk-mail-sign" class="form-input">
              <option value="">Select</option>
              <option value="yes">Yes</option>
              <option value="needs-checking">Needs checking</option>
              <option value="not-necessary">Not necessary</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-hotel"></i>
              <span>AL AH Sign</span>
            </label>
            <select id="settings-al-ah-sign" class="form-input">
              <option value="">Select</option>
              <option value="yes">Yes</option>
              <option value="not-necessary">Not necessary</option>
              <option value="authorized">Authorized</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-key"></i>
              <span>Keys Notice</span>
            </label>
            <select id="settings-keys-notice" class="form-input">
              <option value="">Select</option>
              <option value="yes">Yes</option>
              <option value="needs-checking">Needs checking</option>
              <option value="not-necessary">Not necessary</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-restroom"></i>
              <span>WC Sign</span>
            </label>
            <select id="settings-wc-sign" class="form-input">
              <option value="">Select</option>
              <option value="yes">Yes</option>
              <option value="needs-checking">Needs checking</option>
              <option value="not-necessary">Not necessary</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Condominium Info -->
      <div id="section-condominium-info" class="form-section">
        <div class="section-header">
          <div class="section-icon" style="background: #f3e8ff; color: #7c3aed;">
            <i class="fas fa-building"></i>
          </div>
          <h2 class="section-title">Condominium Info</h2>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-building"></i>
              <span>Condominium Name</span>
            </label>
            <input type="text" id="settings-condominium" class="form-input" placeholder="Enter name">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-envelope"></i>
              <span>Condominium Email</span>
            </label>
            <input type="email" id="settings-condominium-email" class="form-input" placeholder="Enter email">
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-phone"></i>
              <span>Condominium Contact No.</span>
            </label>
            <input type="text" id="settings-condominium-phone" class="form-input" placeholder="Enter contact">
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions">
        <div class="action-buttons">
          <button type="button" id="settings-cancel-btn" class="btn btn-secondary">
            <i class="fas fa-times"></i>
            <span>Cancel</span>
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i>
            <span>Save Settings</span>
          </button>
        </div>
      </div>
    </form>
  </div>

  <script>
    document.getElementById('back-to-dashboard').addEventListener('click', () => window.location.href = 'index.html');
    document.getElementById('settings-cancel-btn').addEventListener('click', () => window.location.href = 'index.html');
    
    // Load property data when page loads
    async function loadPropertyData() {
      const urlParams = new URLSearchParams(window.location.search);
      const propertyId = urlParams.get('id');
      
      if (!propertyId) {
        console.error('No property ID provided');
        return;
      }
      
      // Store property ID for form submission
      document.getElementById('settings-property-id').value = propertyId;
      
      try {
        // Get property data from the properties manager
        // Since we're on a separate page, we need to get the data from the main app
        // For now, let's try to get it from the parent window or use a different approach
        
        // Try to get from sessionStorage (if passed from main app)
        const propertyData = sessionStorage.getItem('currentProperty');
        let property = null;
        
        if (propertyData) {
          property = JSON.parse(propertyData);
        } else {
          // Fallback: try to get from localStorage with a different key
          const properties = JSON.parse(localStorage.getItem('firestore_properties') || '[]');
          property = properties.find(p => p.id === propertyId);
        }
        
        if (property) {
          // Populate property info display
          document.getElementById('property-name-display').textContent = property.name || 'Not specified';
          document.getElementById('property-location-display').textContent = property.location || 'Not specified';
          document.getElementById('property-type-display').textContent = property.typology || property.type || 'Not specified';
          
          // Populate form fields with existing data
          document.getElementById('settings-google-maps-link').value = property.googleMapsLink || '';
          document.getElementById('settings-garbage-location-link').value = property.garbageLocationLink || '';
          document.getElementById('settings-garbage-floor').value = property.garbageFloor || '';
          document.getElementById('settings-checkin-videos').value = property.checkinVideos || '';
          document.getElementById('settings-booking-description-status').value = property.bookingDescriptionStatus || '';
          document.getElementById('settings-google-drive-enabled').value = property.googleDriveEnabled || 'no';
          document.getElementById('settings-google-drive-link').value = property.googleDriveLink || '';
          document.getElementById('settings-scanned-docs-link').value = property.scannedDocsLink || '';
          document.getElementById('settings-recommendations-link').value = property.recommendationsLink || '';
          document.getElementById('settings-recommendations-edit-link').value = property.recommendationsEditLink || '';
          document.getElementById('settings-contracts-status').value = property.contractsStatus || '';
          document.getElementById('settings-complaint-books-status').value = property.complaintBooksStatus || '';
          document.getElementById('settings-statistics-status').value = property.statisticsStatus || '';
          document.getElementById('settings-sef-status').value = property.sefStatus || '';
          document.getElementById('settings-online-complaint-books-enabled').value = property.onlineComplaintBooksEnabled || 'no';
          document.getElementById('settings-online-complaint-books-email').value = property.onlineComplaintBooksEmail || '';
          document.getElementById('settings-online-complaint-books-password').value = property.onlineComplaintBooksPassword || '';
          document.getElementById('settings-airbnb-links-status').value = property.airbnbLinksStatus || '';
          document.getElementById('settings-wifi-speed').value = property.wifiSpeed || '';
          document.getElementById('settings-energy-source').value = property.energySource || '';
          document.getElementById('settings-key-box-code').value = property.keyBoxCode || '';
          document.getElementById('settings-parking-spot').value = property.parkingSpot || '';
          document.getElementById('settings-parking-floor').value = property.parkingFloor || '';
          document.getElementById('settings-air-conditioning').value = property.airConditioning || '0';
          document.getElementById('settings-fans').value = property.fans || '0';
          document.getElementById('settings-heaters').value = property.heaters || '0';
          document.getElementById('settings-crib').value = property.crib || '0';
          document.getElementById('settings-crib-mattress').value = property.cribMattress || '0';
          document.getElementById('settings-baby-chair').value = property.babyChair || '0';
          document.getElementById('settings-wifi-frame').value = property.wifiFrame || '';
          document.getElementById('settings-recommendations-frame').value = property.recommendationsFrame || '';
          document.getElementById('settings-investment-frame').value = property.investmentFrame || '';
          document.getElementById('settings-breakfast-box').value = property.breakfastBox || '';
          document.getElementById('settings-private-sign').value = property.privateSign || '';
          document.getElementById('settings-no-smoking-sign').value = property.noSmokingSign || '';
          document.getElementById('settings-no-junk-mail-sign').value = property.noJunkMailSign || '';
          document.getElementById('settings-al-ah-sign').value = property.alAhSign || '';
          document.getElementById('settings-keys-notice').value = property.keysNotice || '';
          document.getElementById('settings-wc-sign').value = property.wcSign || '';
          document.getElementById('settings-condominium').value = property.condominiumName || '';
          document.getElementById('settings-condominium-email').value = property.condominiumEmail || '';
          document.getElementById('settings-condominium-phone').value = property.condominiumPhone || '';
        } else {
          console.error('Property not found');
          document.getElementById('property-name-display').textContent = 'Property not found';
          document.getElementById('property-location-display').textContent = 'Property not found';
          document.getElementById('property-type-display').textContent = 'Property not found';
        }
      } catch (error) {
        console.error('Error loading property data:', error);
      }
    }
    
    // Handle form submission
    document.getElementById('property-settings-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const propertyId = document.getElementById('settings-property-id').value;
      if (!propertyId) {
        alert('No property ID found');
        return;
      }
      
      // Collect form data
      const formData = {
        googleMapsLink: document.getElementById('settings-google-maps-link').value,
        garbageLocationLink: document.getElementById('settings-garbage-location-link').value,
        garbageFloor: document.getElementById('settings-garbage-floor').value,
        checkinVideos: parseInt(document.getElementById('settings-checkin-videos').value) || 0,
        bookingDescriptionStatus: document.getElementById('settings-booking-description-status').value,
        googleDriveEnabled: document.getElementById('settings-google-drive-enabled').value,
        googleDriveLink: document.getElementById('settings-google-drive-link').value,
        scannedDocsLink: document.getElementById('settings-scanned-docs-link').value,
        recommendationsLink: document.getElementById('settings-recommendations-link').value,
        recommendationsEditLink: document.getElementById('settings-recommendations-edit-link').value,
        contractsStatus: document.getElementById('settings-contracts-status').value,
        complaintBooksStatus: document.getElementById('settings-complaint-books-status').value,
        statisticsStatus: document.getElementById('settings-statistics-status').value,
        sefStatus: document.getElementById('settings-sef-status').value,
        onlineComplaintBooksEnabled: document.getElementById('settings-online-complaint-books-enabled').value,
        onlineComplaintBooksEmail: document.getElementById('settings-online-complaint-books-email').value,
        onlineComplaintBooksPassword: document.getElementById('settings-online-complaint-books-password').value,
        airbnbLinksStatus: document.getElementById('settings-airbnb-links-status').value,
        wifiSpeed: document.getElementById('settings-wifi-speed').value,
        energySource: document.getElementById('settings-energy-source').value,
        keyBoxCode: document.getElementById('settings-key-box-code').value,
        parkingSpot: document.getElementById('settings-parking-spot').value,
        parkingFloor: document.getElementById('settings-parking-floor').value,
        airConditioning: parseInt(document.getElementById('settings-air-conditioning').value) || 0,
        fans: parseInt(document.getElementById('settings-fans').value) || 0,
        heaters: parseInt(document.getElementById('settings-heaters').value) || 0,
        crib: parseInt(document.getElementById('settings-crib').value) || 0,
        cribMattress: parseInt(document.getElementById('settings-crib-mattress').value) || 0,
        babyChair: parseInt(document.getElementById('settings-baby-chair').value) || 0,
        wifiFrame: document.getElementById('settings-wifi-frame').value,
        recommendationsFrame: document.getElementById('settings-recommendations-frame').value,
        investmentFrame: document.getElementById('settings-investment-frame').value,
        breakfastBox: document.getElementById('settings-breakfast-box').value,
        privateSign: document.getElementById('settings-private-sign').value,
        noSmokingSign: document.getElementById('settings-no-smoking-sign').value,
        noJunkMailSign: document.getElementById('settings-no-junk-mail-sign').value,
        alAhSign: document.getElementById('settings-al-ah-sign').value,
        keysNotice: document.getElementById('settings-keys-notice').value,
        wcSign: document.getElementById('settings-wc-sign').value,
        condominiumName: document.getElementById('settings-condominium').value,
        condominiumEmail: document.getElementById('settings-condominium-email').value,
        condominiumPhone: document.getElementById('settings-condominium-phone').value
      };
      
      try {
        // Store the updated data in sessionStorage for the main app to pick up
        const currentProperty = sessionStorage.getItem('currentProperty');
        if (currentProperty) {
          const property = JSON.parse(currentProperty);
          const updatedProperty = { ...property, ...formData };
          sessionStorage.setItem('currentProperty', JSON.stringify(updatedProperty));
          sessionStorage.setItem('propertySettingsUpdated', 'true');
        }
        
        alert('Settings saved successfully! Please return to the main page to see the changes.');
        window.location.href = 'index.html';
      } catch (error) {
        console.error('Error saving settings:', error);
        alert('Error saving settings. Please try again.');
      }
    });
    
    // Load data when page loads
    document.addEventListener('DOMContentLoaded', loadPropertyData);
    // Scroll to and highlight anchored section
    document.addEventListener('DOMContentLoaded', () => {
      const hash = window.location.hash;
      if (hash) {
        const id = hash.substring(1);
        const el = document.getElementById(id);
        if (el) {
          el.scrollIntoView({ behavior: 'smooth', block: 'center' });
          el.classList.add('highlight');
          setTimeout(() => el.classList.remove('highlight'), 3000);
        }
      }
    });
  </script>
  <script src="js/property-settings.js"></script>
      <div class="actions">
        <button type="submit" form="property-settings-form" id="save-bottom-btn" class="btn btn-primary">
          <i class="fas fa-save"></i>
          <span>Save All Settings</span>
        </button>
      </div>
    </form>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="js/property-settings.js"></script>
  <script type="module" src="js/property-settings-controller.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
        const formSections = document.querySelectorAll('.form-section');
        formSections.forEach((section, index) => {
            const header = section.querySelector('.section-header');
            if (header) {
                // Add a toggle icon if one doesn't already exist
                if (!header.querySelector('.section-toggle')) {
                    const toggleIcon = document.createElement('div');
                    toggleIcon.classList.add('section-toggle');
                    toggleIcon.innerHTML = '<i class="fas fa-chevron-down"></i>';
                    header.appendChild(toggleIcon);
                }

                header.addEventListener('click', (e) => {
                    // Make sure we don't trigger this when clicking form elements inside the header
                    if (e.target.closest('input, select, button, a')) return;
                    section.classList.toggle('collapsed');
                });

                // Collapse all sections by default except for the first one
                if (index > 0) {
                    section.classList.add('collapsed');
                }
            }
        });
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const formSections = document.querySelectorAll('.form-section');
      formSections.forEach((section) => {
        section.classList.remove('collapsed');
      });
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Add arrow to each section header
      document.querySelectorAll('.form-section .section-header').forEach(header => {
        // Create arrow element
        const arrow = document.createElement('div');
        arrow.className = 'arrow';
        arrow.innerHTML = '&#x25BC;';
        header.appendChild(arrow);

        // Set initial state: collapsed
        const section = header.parentElement;
        section.classList.remove('expanded');

        // Add click event
        header.addEventListener('click', () => {
          section.classList.toggle('expanded');
          arrow.classList.toggle('expanded');
        });
      });
    });
  </script>
</body>
</html>